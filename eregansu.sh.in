#! /bin/sh

## Eregansu command-line script

## Environment variables:
##
## PHP_5 (defaults to 'php')   The name or path to the PHP interpreter
## EREGANSU_PAUSE_ON_EXIT      If non-empty, don't terminate the script
##                             immediately after the instance has been
##                             finished executing the commands.

if test x"${PHP_5}" = x"" ; then
	PHP_5="php"
fi

platform='@PLATFORMDIR@'
root="`dirname $0`"

php_script=''
if test -r "$root/public/index.php" ; then
	php_script="$root/public/index.php"
elif test -r "$root/index.php" ; then
	php_script="$root/public/index.php"
elif test -r public/index.php ; then
	php_script="public/index.php"
elif test -r index.php ; then
	php_script="index.php"
elif test -r "$platform/index.install.php" ; then
	echo ">>> index.php does not exist, running 'eregansu install'" >&2
	exec ${PHP_5} -f "$platform/index.install.php"
	exit 255
else
	echo "$0: cannot find index.php or $platform/index.install.php" >&2
	exit 1
fi

if test x"$EREGANSU_PAUSE_ON_EXIT" = x"" ; then
	exec ${PHP_5} -f "$php_script" "$@"
else
  	${PHP_5} -f "$php_script" "$@"
	status=$?
	echo "*** Subprocess exited with status $status" >&2
	read dummy
	exit $status
fi
